/*******************************************************************************************
*
*   raylib [audio] example - Module playing (streaming)
*
*   This example has been created using raylib 1.5 (www.raylib.com)
*   raylib is licensed under an unmodified zlib/libpng license (View raylib.h for details)
*
*   Copyright (c) 2016 Ramon Santamaria (@raysan5)
*
********************************************************************************************/


#include "raylib.h"
#define NEZ_TILEMAP_IMPLEMENTATION
#include "tilemap.h"
#define NEZ_TILESET_IMPLEMENTATION
#include "tileset.h"

int screenWidth = 320;
int screenHeight = 180;

// fake camera
typedef struct{
    float x;
    float y;
    int w;
    int h;
}View;

void InitGame(void);
void GameLoop(void);     // Update and Draw one frame
void (*Screen)(void);
void DefaultScreen(void);
void Inputs(void);

TileSet *tileSet;
TileMap *tileMap1;
TileMap *tileMap2;
TileMap *tileMap3;
TileMap *tileMap4;
View cam = {0, 0, 8*9, 8*5};

int main(){
    // Initialization
    //--------------------------------------------------------------------------------------
    InitWindow(screenWidth, screenHeight, "TileMap system test");
	
	
	
#if defined(PLATFORM_WEB)
    emscripten_set_main_loop(GameLoop, 0, 1);
#else
    SetTargetFPS(60);   // Set our game to run at 60 frames-per-second
    //--------------------------------------------------------------------------------------
    InitGame();
    // Main game loop
    while (!WindowShouldClose()){    // Detect window close button or ESC key
        GameLoop();
    }
#endif

    // De-Initialization
    //--------------------------------------------------------------------------------------
    TileSetDestroy(tileSet);
    CloseWindow();        // Close window and OpenGL context
    //--------------------------------------------------------------------------------------
    return 0;
}

int mapWidth = 20;
int mapHeight = 20;
int mapData1[20*20];
int mapData2[20*20];
int mapData3[20*20];
int mapData4[20*20];

Camera2D camera = {0};
void SetMapData(void);
void InitGame(){
	Screen = DefaultScreen;
    camera.zoom = 2.0f;
    SetMapData();
    
    tileSet = TileSetNewInitFromFile("../Resource/RDE_8x8.png", 8, 8, NULL, 0);
    
    tileMap1 = TileMapNew();
    tileMap1->tileSet = tileSet;
    tileMap1->width = 20;
    tileMap1->height = 20;
    tileMap1->grid = (int*)&mapData1;
    
    tileMap2 = TileMapNew();
    tileMap2->tileSet = tileSet;
    tileMap2->width = 20;
    tileMap2->height = 20;
    tileMap2->grid = (int*)&mapData2;
    
    tileMap3 = TileMapNew();
    tileMap3->tileSet = tileSet;
    tileMap3->width = 20;
    tileMap3->height = 20;
    tileMap3->grid = (int*)&mapData3;
    
    tileMap4 = TileMapNew();
    tileMap4->tileSet = tileSet;
    tileMap4->width = 20;
    tileMap4->height = 20;
    tileMap4->grid = (int*)&mapData4;
    
}



void GameLoop(void){
	Screen();
}


void DefaultScreen(){
    Inputs();
    //----------------------------------------------------------------------------------
    BeginDrawing();
    ClearBackground(BLACK);
    BeginMode2D(camera);
        TileMapDrawGrid(tileMap1, GRAY);
        // only draw tiles that camera can see
        // Since height color gradient should be game specific, in example it's done with transparent black rectangle between layers
        TileMapDrawExWorld(tileMap1, (int)cam.x, (int)cam.y, cam.w, cam.h);
        DrawRectangle(0, 0, screenWidth, screenHeight, (Color){0,0,0,100});
        TileMapDrawExSpreadWorld(tileMap2, (int)cam.x, (int)cam.y, cam.w, cam.h, 1.0, 1.0);
        DrawRectangle(0, 0, screenWidth, screenHeight, (Color){0,0,0,100});
        TileMapDrawExSpreadWorld(tileMap3, (int)cam.x, (int)cam.y, cam.w, cam.h, 2.0, 2.0);
        DrawRectangle(0, 0, screenWidth, screenHeight, (Color){0,0,0,100});
        TileMapDrawExSpreadWorld(tileMap4, (int)cam.x, (int)cam.y, cam.w, cam.h, 3.0, 3.0);
        DrawRectangleLines(cam.x, cam.y, cam.w, cam.h, LIGHTGRAY);
    EndMode2D();
    EndDrawing();
}


// move fake camera
void Inputs(){
    cam.x += ((int)(IsKeyDown(KEY_D)||IsKeyDown(KEY_RIGHT)) - (int)(IsKeyDown(KEY_A)||IsKeyDown(KEY_LEFT))) *0.5;
    cam.y += ((int)(IsKeyDown(KEY_S)||IsKeyDown(KEY_DOWN)) - (int)(IsKeyDown(KEY_W)||IsKeyDown(KEY_UP))) *0.5;
    
    float visibleWidth = screenWidth / camera.zoom;
    float visibleHeight = screenHeight / camera.zoom;
    
    camera.target.x = cam.x -(visibleWidth -cam.w) *0.5;
    camera.target.y = cam.y -(visibleHeight -cam.h) *0.5;
}

void SetMapData(){
    int d1[] = {
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  249,  -1,  249,  -1,  249,  -1,  249,  -1, 249,  -1,  249,  -1,  249,  -1,  249,  -1,  249, -1,  249,
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  249,  -1,  249,  -1,  249,  -1,  249,  -1, 249,  -1,  249,  -1,  249,  -1,  249,  -1,  249, -1,  249, 
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  45,  -1,  45,  -1,  45,  -1,  45,  -1,  45,  -1,  45,  -1,  45,  -1,  45,  -1,  45,  -1,  45,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  197,  196,  196,  197,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  179,  -1,  -1,  179,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  179,  -1,  -1,  179,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  197,  196,  196,  197,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  249,  -1,  249,  -1,  249,  -1,  249,  -1, 249,  -1,  249,  -1,  249,  -1,  249,  -1,  249, -1,  249, 
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  249,  -1,  249,  -1,  249,  -1,  249,  -1, 249,  -1,  249,  -1,  249,  -1,  249,  -1,  249, -1,  249,  
};
    int d2[] = {
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  249,  -1,  249,  -1,  42,  -1,  249,  -1, 249,  -1,  42,  -1,  249,  -1,  249,  -1,  249, -1,  249,
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,
-1,  249,  -1,  249,  -1,  249,  -1,  42,  -1, 249,  -1,  249,  -1,  249,  -1,  249,  -1,  42, -1,  42, 
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1, 
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  197,  196,  196,  197,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  179,  -1,  -1,  179,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  179,  -1,  -1,  179,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  197,  196,  196,  197,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  249,  -1,  249,  -1,  42,  -1,  249,  -1, 249,  -1,  42,  -1,  249,  -1,  249,  -1,  249, -1,  249,
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,
-1,  249,  -1,  249,  -1,  249,  -1,  42,  -1, 249,  -1,  249,  -1,  249,  -1,  249,  -1,  42, -1,  42,
};
    int d3[] = {
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  42,  -1,  249,  -1,  -1,  -1,  42,  -1, 249,  -1,  -1,  -1,  249,  -1,  42,  -1,  42, -1,  249,
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,
-1,  249,  -1,  42,  -1,  249,  -1,  -1,  -1, 249,  -1,  42,  -1,  42,  -1,  249,  -1,  -1, -1,  -1, 
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1, 
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  197,  196,  196,  197,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  179,  -1,  -1,  179,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  179,  -1,  -1,  179,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  197,  196,  196,  197,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  42,  -1,  249,  -1,  -1,  -1,  42,  -1, 249,  -1,  -1,  -1,  249,  -1,  42,  -1,  42, -1,  249,
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,
-1,  249,  -1,  42,  -1,  249,  -1,  -1,  -1, 249,  -1,  42,  -1,  42,  -1,  249,  -1,  -1, -1,  -1, 
};
    int d4[] = {
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  42,  -1,  -1,  -1,  -1,  -1, 42,  -1,  -1,  -1,  42,  -1,  -1,  -1,  -1, -1,  42,
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,
-1,  42,  -1,  -1,  -1,  42,  -1,  -1,  -1, 42,  -1,  -1,  -1,  -1,  -1,  42,  -1,  -1, -1,  -1,
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1, 
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  197,  196,  196,  197,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  179,  -1,  -1,  179,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  179,  -1,  -1,  179,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  197,  196,  196,  197,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  
-1,  -1,  -1,  42,  -1,  -1,  -1,  -1,  -1, 42,  -1,  -1,  -1,  42,  -1,  -1,  -1,  -1, -1,  42,
-1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,  -1,
-1,  42,  -1,  -1,  -1,  42,  -1,  -1,  -1, 42,  -1,  -1,  -1,  -1,  -1,  42,  -1,  -1, -1,  -1,
};

for (int i=0; i<20*20; i++){
    mapData1[i] = d1[i];
    mapData2[i] = d2[i];
    mapData3[i] = d3[i];
    mapData4[i] = d4[i];
}

}

















